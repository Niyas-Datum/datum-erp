<form [formGroup]="debitNoteForm">
  <div class="row">
    <div class="col-md-12">
      <div class="row align-items-start">
        <div class="col-md-6">
          <div class="row">
            <label for="voucherNo" class="form-label col-md-4">Voucher No<span
                class="required-asterisk">*</span></label>
            <div class="col-md-4">
              <ejs-textbox id="voucherName" formControlName="voucherName" cssClass="e-input"></ejs-textbox>
              @if (debitNoteForm.get('voucherName')?.hasError('required')) {
              <small class="text-danger">This field is required.</small>
              }
            </div>
            <div class="col-md-4">
              <ejs-textbox id="voucherNo" formControlName="voucherNo" cssClass="e-input"></ejs-textbox>
              @if (debitNoteForm.get('voucherNo')?.hasError('required')) {
              <small class="text-danger">This field is required.</small>
              }
            </div>
          </div>
          <div class="row">
            <label for="voucherDate" class="form-label col-md-4">Voucher Date<span
                class="required-asterisk">*</span></label>
            <div class="col-md-8">
              <ejs-datepicker id="voucherDate" formControlName="voucherDate" placeholder="dd/MM/yyyy"
                format="dd/MM/yyyy">
              </ejs-datepicker>
              @if (debitNoteForm.get('voucherDate')?.hasError('required')) {
              <small class="text-danger">This field is required.</small>
              }
            </div>
          </div>
        </div>

        <!-- Supplier and Particulars Section (Replaces Payment Type Buttons) -->
        <div class="col-md-6">
          <div class="row">
            <label for="supplierName" class="form-label col-md-4">Supplier<span
                class="required-asterisk">*</span></label>
            <div class="col-md-8">
              <ejs-dropdownlist
                id="supplierName"
                formControlName="supplierName"
                [dataSource]="supplierData"
                [fields]="{ text: 'name', value: 'id' }"
                placeholder="Select Supplier"
                [allowFiltering]="true"
                filterType="Contains"
                (change)="onSupplierSelect($event)"
                (filtering)="onSupplierFiltering($event)">
              </ejs-dropdownlist>
              @if (debitNoteForm.get('supplierName')?.hasError('required')) {
              <small class="text-danger">This field is required.</small>
              }
            </div>
          </div>
          <div class="row mt-2">
            <label for="particulars" class="form-label col-md-4">Particulars</label>
            <div class="col-md-8">
              <ejs-dropdownlist
                id="particulars"
                formControlName="particulars"
                [dataSource]="particularsData"
                [fields]="{ text: 'name', value: 'id' }"
                placeholder="Select Particulars">
              </ejs-dropdownlist>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <label for="narration" class="form-label col-md-2">Narration</label>
        <div class="col-md-10">
          <ejs-textbox id="narration" formControlName="narration" cssClass="e-input"></ejs-textbox>
        </div>
      </div>

      <div class="row">
        <label for="referenceNo" class="form-label col-md-2">Reference No</label>
        <div class="col-md-4">
          <ejs-textbox id="referenceNo" formControlName="referenceNo" cssClass="e-input"></ejs-textbox>
        </div>
      </div>

      <!-- Account Details Grid (DEBIT COLUMN ONLY) -->
      <div class="row mt-3">
        <div class="col-md-12">
          <h6 class="section-title">Account Details</h6>
          <ejs-grid #accountDetailsGrid [dataSource]="voucherCommonService.accountDetailsData()" [editSettings]="accountDetailsEditSettings"
            [allowResizing]="true" [allowTextWrap]="true" gridLines="Both" height="300px" [rowHeight]="30"
            (cellSave)="onAccountDetailsCellSave($event)">
            <e-columns>
              <e-column field="accountCode" headerText="AccountCode" width="150">
                <ng-template #editTemplate let-data>
                  <ejs-multicolumncombobox
                    [dataSource]="voucherService.accountMasterData()"
                    [fields]='{text: "accountCode", value: "accountCode"}'
                    [value]="data.accountCode"
                    [showClearButton]="true"
                    [allowFiltering]="true"
                    filterType="Contains"
                    placeholder="Search by Account Code or Name..."
                    popupWidth="600px"
                    (change)="onAccountSelect($event, data)"
                    (filtering)="onAccountFiltering($event)">
                    <e-columns>
                      <e-column field="accountCode" headerText="Account Code" width="150"></e-column>
                      <e-column field="accountName" headerText="Account Name" width="250"></e-column>
                    </e-columns>
                  </ejs-multicolumncombobox>
                </ng-template>
              </e-column>
              <e-column field="accountName" headerText="AccountName" width="200" [allowEditing]="false"></e-column>
              <e-column field="description" headerText="Description" width="250"></e-column>
              <e-column field="dueDate" headerText="DueDate" width="120"></e-column>
              <e-column
                field="credit"
                headerText="Credit"
                width="120"
                textAlign="Right"
                format="N2"
                type="number"
                editType="numericedit"
                [edit]="creditEditParams">
              </e-column>
            </e-columns>
          </ejs-grid>
        </div>
      </div>

      <!-- NOTE: NO Payment Details Grid for Debit Note -->

    </div>
  </div>
</form>

<!-- PO Allocation Popup Component (NO Payment Popup) -->
<app-poallocationpopup
  #poAllocationPopup
  (allocationComplete)="onAllocationComplete($event)">
</app-poallocationpopup>
